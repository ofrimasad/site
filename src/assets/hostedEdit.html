<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Malabi edit</title>
</head>
<body>

<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>
<script src="https://api.malabi.co/v1/Malabi.js"></script>
<style media="screen" type="text/css" scoped>
  .modal-wider {
    width: 90%;
    height: 90%;
  }
  .malabi-Iframe{
    height:677px;
  }

</style>
<script>

  function getUrlVars() {
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
      hash = hashes[i].split('=');
      vars.push(hash[0]);
      vars[hash[0]] = hash[1];
    }
    return vars;
  }

  var vars = getUrlVars();

  var onSaveWithResult = function (image) {

    var url = decodeURIComponent(vars['callback']);
    var request = new XMLHttpRequest();
    request.open('POST', url, true);
    request.setRequestHeader("Content-type", "application/json");
    request.send(JSON.stringify({image: image}));
    window.history.back();
  };

  $(document).ready(function () {
    malabi.init({
      "apiId": vars['apiId'],
      "onFrameReady": function() {
        malabi.edit(vars['id'], vars['secret'], onSaveWithResult);
      }
    });

  });
</script>

</body>
</html>
