!function(p,g){var b="malabiEditorModal",t=new function(){var r,s;this.apiUrl="api.malabi.co/v1",this.apiId=null,this.framework="materialize",this.isBootstrap=!1,this.userId=null,this.sessionToken=null,this.sqsRunning=!1,this.malabiEditorText=f,this.iframeElement=null,this.isInit=!1,this.functionArrayToRunAferInit=[],this.settings={},this.editorFrame={};var l="";this.transparent=!1,this.overrideTutorialElement=e,this.injectStyleToIframe=y;var a={exists:function(t,e){var a=new RegExp("(^| )"+e+"( |$)");return t.className&&t.className.match(a)},add:function(t,e){if(this.exists(t,e))return!0;t.className+=" "+e},remove:function(t,e){var a=t.className,n=new RegExp("(^| )"+e+"( |$)");a=a.replace(n," ").replace(/  /g," "),t.className=a}},d=function(){g.getElementById("malabi-loader")?g.getElementById("malabi-loader").style.visibility="hidden":console.error("Error Malabi Init: Loader element not found, looking for #malabi-loader element. Or add your override with your own callbackStopLoader function.")};var m=function(a,t){var e,n,o;"string"==typeof a.local&&(e=t.malabiUrl+"lang/"+a.local+".json",n=function(t){var e=JSON.parse(t);null!=e&&(a.local=e).hasOwnProperty("show-tutorial-first-time")&&(a["show-tutorial-first-time"]=e["show-tutorial-first-time"])},(o=new XMLHttpRequest).overrideMimeType("application/json"),o.open("GET",e,!1),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&n(o.responseText)},o.send(null))};this.init=function(t){if(t&&t.apiId||console.error("Malabi init() fail - you must supply an object containing the apiId"),this.isInit)null!=this.settings.onFrameReady&&"function"==typeof this.settings.onFrameReady&&this.settings.onFrameReady();else{var e,a,n,o,i,r;a=g,n="script",o="ga",(e=p).GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=a.createElement(n),r=a.getElementsByTagName(n)[0],i.async=1,i.src="https://www.google-analytics.com/analytics.js",r.parentNode.insertBefore(i,r),ga("create","UA-75726540-1","auto"),ga("send","pageview"),ga(function(t){var e=t.get("clientId");ga("set","dimension1",e)}),this.isInit=!0,this.apiId=t.apiId,null!=t.framework&&(this.framework=t.framework,"bootstrap"!=this.framework&&"Bootstrap"!=this.framework||(this.isBootstrap=!0));var s=g.querySelector('script[src*="Malabi"]');this.settings=t,this.malabiUrl=s.src.substring(0,s.src.indexOf("Malabi")),this.settings.RETURN_IFRAME=1,this.settings.RETURN_EDITOR=2,this.settings.hasOwnProperty("malabiEditorText")&&(this.malabiEditorText=Object.assign(this.malabiEditorText,this.settings.malabiEditorText)),this.settings.hasOwnProperty("transparent")&&1==this.settings.transparent&&(this.transparent=!0),c(this.isBootstrap,this.malabiUrl),t.hasOwnProperty("local")&&(m(t,this),m(t,this)),u(this),t.apiUrl&&(this.apiUrl=t.apiUrl,console.log("API URL set to: "+this.apiUrl))}};var c=function(t,e){t?(n("https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"),n("https://fonts.googleapis.com/icon?family=Material+Icons"),n("https://fonts.googleapis.com/css?family=Roboto")):(n("https://fonts.googleapis.com/icon?family=Material+Icons"),n("https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css"),n(e+"malabi-editor.css"))},n=function(t){for(var e=g.styleSheets,a=0;a<e.length;a++)if(e[a].href==t)return void console.log(t+" already exist");var n=g.createElement("link");n.setAttribute("href",t),n.setAttribute("rel","stylesheet"),g.head.appendChild(n)},u=function(n){if(!g.getElementById(b)){var o=g.createElement("div");o.id=b,n.isBootstrap?(o.setAttribute("class","modal fade bd-example-modal-lg"),o.setAttribute("tabindex","-1"),o.setAttribute("role","dialog"),o.setAttribute("style","display: none;")):(o.setAttribute("class","modal modal-wider"),o.setAttribute("style","margin-bottom: -8px;display: none;")),g.body.appendChild(o);var i=new XMLHttpRequest;n.isBootstrap?i.open("GET",n.malabiUrl+"modal.bootstrap.html",!0):i.open("GET",n.malabiUrl+"modal.html",!0),i.send(null),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var t=i.getResponseHeader("Content-Type");if(1!==t.indexOf("text")){o.innerHTML=i.responseText.trim(),n.settings.hasOwnProperty("local")&&function(t){for(var e in t)t.hasOwnProperty(e)&&(null!=g.getElementById(e)&&(g.getElementById(e).innerText=t[e]),null!=f[e]&&(f[e]=t[e]))}(n.settings.local),l=n.settings.hasOwnProperty("iFrameSrc")&&1<n.settings.iFrameSrc.length?n.settings.iFrameSrc:p.location.protocol+"//d8tv8no6fkiw3.cloudfront.net/version/v4/index.html",r=function(t){var e=t.match(/\/\/(.[^/]+)/);{if(null==e){var a=p.location.href,n=a.split("/");return e=n[0]+"//"+n[2]}return p.location.protocol+"//"+e[1]}}(l),s=g.createElement("iFrame"),n.iframeElement=s;var e=g.getElementById("malabiFrame");null!=e&&void 0!==e||(s.frameBorder=0,s.width="100%",s.height="100%",s.id="malabiFrame",s.setAttribute("src",l),s.style="border:0;",g.getElementById("malabiEditorIFrame").appendChild(s));var a=n;s.addEventListener("load",function(){a.editorFrame=g.getElementById("malabiFrame"),d(a.settings.RETURN_IFRAME),h(),a.settings&&a.editorFrame.contentWindow.postMessage({initMalabi:JSON.stringify(a.settings)},r),a.injectStyleToIframe&&a.iframeElement.contentDocument.head.appendChild(a.injectStyleToIframe),a.overrideTutorialElement&&(a.iframeElement.contentDocument.getElementById("show-tutorial-first-time").innerHTML="",a.iframeElement.contentDocument.getElementById("show-tutorial-first-time").appendChild(a.overrideTutorialElement))})}}}}},h=function(){var t=g.querySelectorAll('*[id^="malabi-btn"]');if(0<t.length)for(var e=0;e<t.length;e++)a.remove(t[e],"disabled")},o=function(){var t=g.querySelectorAll('*[id^="malabi-btn"]');if(0<t.length)for(var e=0;e<t.length;e++)a.add(t[e],"disabled")};this.edit=function(t,e,a,n){if(!this.isInit)return console.error("please call malabi.init() before calling this function"),!1;if(u(),h(),i.isBootstrap){var o=$("#"+b);o.modal("show"),o.on("hidden.bs.modal",function(t){g.cookie="AWSELB=;expires=Sat, 01-Jan-2000 00:00:00 GMT;",null!=n&&"function"==typeof n&&n()})}else $("#"+b).openModal({complete:function(){g.cookie="AWSELB=;expires=Sat, 01-Jan-2000 00:00:00 GMT;",null!=n&&"function"==typeof n&&n()}});return ga("send","event","Site","open editor","apiId="+this.apiId+"imageId="+t),this.responseOnSave=a&&"function"==typeof a?a:null,this.editorFrame.contentWindow.postMessage({action:"openEditor",apiId:this.apiId,imageId:t,secret:e},r),!0},this.setColor=function(t){return this.editorFrame.contentWindow.postMessage("setColor_"+t,r),1},this.backToEdit=function(){return this.editorFrame.contentWindow.postMessage({action:"backToEdit"},r),1},this.showResult=function(){var t=!1,e=!1;g.getElementById("malabi-show-shadow")&&(t=g.getElementById("malabi-show-shadow").checked),g.getElementById("malabi-show-transparent")&&(e=g.getElementById("malabi-show-transparent").checked);var a={action:"showResult",removeShadow:t,applyTransparent:e};return this.editorFrame.contentWindow.postMessage(a,r),1},this.saveImage=function(){var t=!1,e=!1;g.getElementById("malabi-show-shadow")&&(t=g.getElementById("malabi-show-shadow").checked),g.getElementById("malabi-show-transparent")&&(e=g.getElementById("malabi-show-transparent").checked);var a={action:"saveImage",removeShadow:t,applyTransparent:e};return this.editorFrame.contentWindow.postMessage(a,r),1},this.zoomIn=function(){return this.editorFrame.contentWindow.postMessage("zoomIn",r),1},this.zoomOut=function(){return this.editorFrame.contentWindow.postMessage("zoomOut",r),1},this.onclickLongZoomIn=function(){return this.editorFrame.contentWindow.postMessage("onclickLongZoomIn",r),1},this.onmouseupLongZoomIn=function(){return this.editorFrame.contentWindow.postMessage("onmouseupLongZoomIn",r),1},this.onclickLongZoomOut=function(){return this.editorFrame.contentWindow.postMessage("onclickLongZoomOut",r),1},this.onmouseupLongZoomOut=function(){return this.editorFrame.contentWindow.postMessage("onmouseupLongZoomOut",r),1},this.undo=function(){return this.editorFrame.contentWindow.postMessage("undo",r),1};var i=this;p.addEventListener("message",function(t){if(t.origin===r){var e=t.data;if(0==t.data&&console.log("callbackFuncClose"),t.data.hasOwnProperty("url")&&5<e.url.length&&(h(),i.isBootstrap?$("#"+b).modal("toggle"):$("#"+b).closeModal(),g.cookie="AWSELB=;expires=Sat, 01-Jan-2000 00:00:00 GMT;","function"==typeof i.responseOnSave?i.responseOnSave(JSON.parse(e.url)):console.error("No function to run on save. Implment 'callbackFuncSave', recieves url.")),t.data.hasOwnProperty("loader")&&(1==e.loader&&(o(),g.getElementById("malabi-loader")?g.getElementById("malabi-loader").style.visibility="":console.error("Error Malabi Init: Loader element not found, looking for #malabi-loader element. Or add your override with your own callbackStartLoader function.")),0==e.loader&&d(this.RETURN_EDITOR)),t.data.hasOwnProperty("error")&&(console.error(e),d()),t.data.hasOwnProperty("returnFromShowResult")){if(p.malabi.settings.hasOwnProperty("returnFromShowResult"))return void p.malabi.settings.returnFromShowResult();g.getElementById("malabi-btn-show-result")&&(g.getElementById("malabi-btn-show-result").innerText=f["malabi-btn-show-result"]),h()}t.data.hasOwnProperty("inEditMode")&&(d(),h(),p.malabi.settings.hasOwnProperty("callbackInEditMode")&&p.malabi.settings.callbackInEditMode()),t.data.hasOwnProperty("callbackInShowResult")&&(console.log("callbackInShowResult"),p.malabi.settings.hasOwnProperty("callbackInShowResult")&&p.malabi.settings.callbackInShowResult(),d(),h(),function(){if(g.getElementById("malabi-btn-undo")){var t=g.getElementById("malabi-btn-undo");a.add(t,"disabled")}else console.error("Error Malabi Init: malabi-btn-undo element not found, looking for #malabi-btn-undo element. Or add your override with your own callbackDisableUndo function.")}(),g.getElementById("malabi-btn-show-result")&&(g.getElementById("malabi-btn-show-result").innerText=f["back-to-edit"])),t.data.hasOwnProperty("initMalabi")&&p.malabi.settings.hasOwnProperty("onFrameReady")&&"function"==typeof p.malabi.settings.onFrameReady&&p.malabi.settings.onFrameReady()}})};p.waitForSQS=!1,p.malabi=t;var f={"malabi-btn-show-result":"preview result","back-to-edit":"back to edit","tooltip-mark-background":"Draw lines to mark areas you want to remove from the image","tooltip-mark-object":"Draw lines to mark areas you want to keep in the image"};p.malabiEditorText=f;var e=null,y=null}(this,document);
