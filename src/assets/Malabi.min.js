!function(g,b){var f="malabiEditorModal",t=new function(){var s,l;this.apiUrl="api.malabi.co/v1",this.apiId=null,this.framework="materialize",this.isBootstrap=!1,this.userId=null,this.sessionToken=null,this.sqsRunning=!1,this.malabiEditorText=y,this.iframeElement=null,this.isInit=!1,this.functionArrayToRunAferInit=[],this.settings={},this.editorFrame={};var d="";this.transparent=!1,this.overrideTutorialElement=e,this.injectStyleToIframe=r;var a={exists:function(t,e){var a=new RegExp("(^| )"+e+"( |$)");return t.className&&t.className.match(a)},add:function(t,e){if(this.exists(t,e))return!0;t.className+=" "+e},remove:function(t,e){var a=t.className,o=new RegExp("(^| )"+e+"( |$)");a=a.replace(o," ").replace(/  /g," "),t.className=a}},m=function(){b.getElementById("malabi-loader")?b.getElementById("malabi-loader").style.visibility="hidden":console.error("Error Malabi Init: Loader element not found, looking for #malabi-loader element. Or add your override with your own callbackStopLoader function.")};var c=function(a,t){var e,o,n;"string"==typeof a.local&&(e=t.malabiUrl+"lang/"+a.local+".json",o=function(t){var e=JSON.parse(t);null!=e&&(a.local=e).hasOwnProperty("show-tutorial-first-time")&&(a["show-tutorial-first-time"]=e["show-tutorial-first-time"])},(n=new XMLHttpRequest).overrideMimeType("application/json"),n.open("GET",e,!1),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&o(n.responseText)},n.send(null))};this.init=function(t){if(t&&t.apiId||console.error("Malabi init() fail - you must supply an object containing the apiId"),this.isInit)null!=this.settings.onFrameReady&&"function"==typeof this.settings.onFrameReady&&this.settings.onFrameReady();else{var e,a,o,n,i,r;a=b,o="script",n="ga",(e=g).GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=a.createElement(o),r=a.getElementsByTagName(o)[0],i.async=1,i.src="https://www.google-analytics.com/analytics.js",r.parentNode.insertBefore(i,r),ga("create","UA-75726540-1","auto"),ga("set", "anonymizeip", true);,ga("send","pageview"),ga(function(t){var e=t.get("clientId");ga("set","dimension1",e)}),this.isInit=!0,this.apiId=t.apiId,null!=t.framework&&(this.framework=t.framework,"bootstrap"!=this.framework&&"Bootstrap"!=this.framework||(this.isBootstrap=!0));var s=b.querySelector('script[src*="Malabi"]');this.settings=t,this.malabiUrl=s.src.substring(0,s.src.indexOf("Malabi")),this.settings.RETURN_IFRAME=1,this.settings.RETURN_EDITOR=2,this.settings.hasOwnProperty("malabiEditorText")&&(this.malabiEditorText=Object.assign(this.malabiEditorText,this.settings.malabiEditorText)),this.settings.hasOwnProperty("transparent")&&1==this.settings.transparent&&(this.transparent=!0),u(this.isBootstrap,this.malabiUrl),t.hasOwnProperty("local")&&(c(t,this),c(t,this)),h(this),t.apiUrl&&(this.apiUrl=t.apiUrl,console.log("API URL set to: "+this.apiUrl))}};var u=function(t,e){t?(o("https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"),o("https://fonts.googleapis.com/icon?family=Material+Icons"),o("https://fonts.googleapis.com/css?family=Roboto")):(o("https://fonts.googleapis.com/icon?family=Material+Icons"),o("https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css"),o(e+"malabi-editor.css"))},o=function(t){for(var e=b.styleSheets,a=0;a<e.length;a++)if(e[a].href==t)return void console.log(t+" already exist");var o=b.createElement("link");o.setAttribute("href",t),o.setAttribute("rel","stylesheet"),b.head.appendChild(o)},h=function(n){if(!b.getElementById(f)){var i=b.createElement("div");i.id=f,n.isBootstrap?(i.setAttribute("class","modal fade bd-example-modal-lg"),i.setAttribute("tabindex","-1"),i.setAttribute("role","dialog"),i.setAttribute("style","display: none;")):(i.setAttribute("class","modal modal-wider"),i.setAttribute("style","margin-bottom: -8px;display: none;")),b.body.appendChild(i);var r=new XMLHttpRequest;n.isBootstrap?r.open("GET",n.malabiUrl+"modal.bootstrap.html",!0):r.open("GET",n.malabiUrl+"modal.html",!0),r.send(null),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){var t=r.getResponseHeader("Content-Type");if(1!==t.indexOf("text")){if(i.innerHTML=r.responseText.trim(),n.settings.hasOwnProperty("local")&&function(t){for(var e in t)t.hasOwnProperty(e)&&(null!=b.getElementById(e)&&(b.getElementById(e).innerText=t[e]),null!=y[e]&&(y[e]=t[e]))}(n.settings.local),n.settings.hasOwnProperty("iFrameSrc")&&1<n.settings.iFrameSrc.length)d=n.settings.iFrameSrc;else{var e=g.location.protocol;"file:"==g.location.protocol&&(e="https:"),d=e+"//d8tv8no6fkiw3.cloudfront.net/version/v4/index.html"}s=function(t){var e=t.match(/\/\/(.[^/]+)/);{if(null==e){var a=g.location.href,o=a.split("/");return e=o[0]+"//"+o[2]}var n=g.location.protocol;return"file:"==g.location.protocol&&(n="https:"),n+"//"+e[1]}}(d),l=b.createElement("iFrame"),n.iframeElement=l;var a=b.getElementById("malabiFrame");null!=a&&void 0!==a||(l.frameBorder=0,l.width="100%",l.height="100%",l.id="malabiFrame",l.setAttribute("src",d),l.style="border:0;",b.getElementById("malabiEditorIFrame").appendChild(l));var o=n;l.addEventListener("load",function(){o.editorFrame=b.getElementById("malabiFrame"),m(o.settings.RETURN_IFRAME),p(),o.settings&&o.editorFrame.contentWindow.postMessage({initMalabi:JSON.stringify(o.settings)},s),o.injectStyleToIframe&&o.iframeElement.contentDocument.head.appendChild(o.injectStyleToIframe),o.overrideTutorialElement&&(o.iframeElement.contentDocument.getElementById("show-tutorial-first-time").innerHTML="",o.iframeElement.contentDocument.getElementById("show-tutorial-first-time").appendChild(o.overrideTutorialElement))})}}}}},p=function(){var t=b.querySelectorAll('*[id^="malabi-btn"]');if(0<t.length)for(var e=0;e<t.length;e++)a.remove(t[e],"disabled")},n=function(){var t=b.querySelectorAll('*[id^="malabi-btn"]');if(0<t.length)for(var e=0;e<t.length;e++)a.add(t[e],"disabled")};this.edit=function(t,e,a,o){if(!this.isInit)return console.error("please call malabi.init() before calling this function"),!1;if(h(),p(),i.isBootstrap){var n=$("#"+f);n.modal("show"),n.on("hidden.bs.modal",function(t){b.cookie="AWSELB=;expires=Sat, 01-Jan-2000 00:00:00 GMT;",null!=o&&"function"==typeof o&&o()})}else $("#"+f).openModal({complete:function(){b.cookie="AWSELB=;expires=Sat, 01-Jan-2000 00:00:00 GMT;",null!=o&&"function"==typeof o&&o()}});return ga("send","event","Site","open editor","apiId="+this.apiId+"imageId="+t),this.responseOnSave=a&&"function"==typeof a?a:null,this.editorFrame.contentWindow.postMessage({action:"openEditor",apiId:this.apiId,imageId:t,secret:e},s),!0},this.setColor=function(t){return this.editorFrame.contentWindow.postMessage("setColor_"+t,s),1},this.backToEdit=function(){return this.editorFrame.contentWindow.postMessage({action:"backToEdit"},s),1},this.showResult=function(){var t=!1,e=!1;b.getElementById("malabi-show-shadow")&&(t=b.getElementById("malabi-show-shadow").checked),b.getElementById("malabi-show-transparent")&&(e=b.getElementById("malabi-show-transparent").checked);var a={action:"showResult",removeShadow:t,applyTransparent:e};return this.editorFrame.contentWindow.postMessage(a,s),1},this.saveImage=function(){var t=!1,e=!1;b.getElementById("malabi-show-shadow")&&(t=b.getElementById("malabi-show-shadow").checked),b.getElementById("malabi-show-transparent")&&(e=b.getElementById("malabi-show-transparent").checked);var a={action:"saveImage",removeShadow:t,applyTransparent:e};return this.editorFrame.contentWindow.postMessage(a,s),1},this.zoomIn=function(){return this.editorFrame.contentWindow.postMessage("zoomIn",s),1},this.zoomOut=function(){return this.editorFrame.contentWindow.postMessage("zoomOut",s),1},this.onclickLongZoomIn=function(){return this.editorFrame.contentWindow.postMessage("onclickLongZoomIn",s),1},this.onmouseupLongZoomIn=function(){return this.editorFrame.contentWindow.postMessage("onmouseupLongZoomIn",s),1},this.onclickLongZoomOut=function(){return this.editorFrame.contentWindow.postMessage("onclickLongZoomOut",s),1},this.onmouseupLongZoomOut=function(){return this.editorFrame.contentWindow.postMessage("onmouseupLongZoomOut",s),1},this.undo=function(){return this.editorFrame.contentWindow.postMessage("undo",s),1};var i=this;g.addEventListener("message",function(t){if(t.origin===s){var e=t.data;if(0==t.data&&console.log("callbackFuncClose"),t.data.hasOwnProperty("url")&&5<e.url.length&&(p(),i.isBootstrap?$("#"+f).modal("toggle"):$("#"+f).closeModal(),b.cookie="AWSELB=;expires=Sat, 01-Jan-2000 00:00:00 GMT;","function"==typeof i.responseOnSave?i.responseOnSave(JSON.parse(e.url)):console.error("No function to run on save. Implment 'callbackFuncSave', recieves url.")),t.data.hasOwnProperty("loader")&&(1==e.loader&&(n(),b.getElementById("malabi-loader")?b.getElementById("malabi-loader").style.visibility="":console.error("Error Malabi Init: Loader element not found, looking for #malabi-loader element. Or add your override with your own callbackStartLoader function.")),0==e.loader&&m(this.RETURN_EDITOR)),t.data.hasOwnProperty("error")&&(console.error(e),m()),t.data.hasOwnProperty("returnFromShowResult")){if(g.malabi.settings.hasOwnProperty("returnFromShowResult"))return void g.malabi.settings.returnFromShowResult();b.getElementById("malabi-btn-show-result")&&(b.getElementById("malabi-btn-show-result").innerText=y["malabi-btn-show-result"]),p()}t.data.hasOwnProperty("inEditMode")&&(m(),p(),g.malabi.settings.hasOwnProperty("callbackInEditMode")&&g.malabi.settings.callbackInEditMode()),t.data.hasOwnProperty("callbackInShowResult")&&(console.log("callbackInShowResult"),g.malabi.settings.hasOwnProperty("callbackInShowResult")&&g.malabi.settings.callbackInShowResult(),m(),p(),function(){if(b.getElementById("malabi-btn-undo")){var t=b.getElementById("malabi-btn-undo");a.add(t,"disabled")}else console.error("Error Malabi Init: malabi-btn-undo element not found, looking for #malabi-btn-undo element. Or add your override with your own callbackDisableUndo function.")}(),b.getElementById("malabi-btn-show-result")&&(b.getElementById("malabi-btn-show-result").innerText=y["back-to-edit"])),t.data.hasOwnProperty("initMalabi")&&g.malabi.settings.hasOwnProperty("onFrameReady")&&"function"==typeof g.malabi.settings.onFrameReady&&g.malabi.settings.onFrameReady()}})};g.waitForSQS=!1,g.malabi=t;var y={"malabi-btn-show-result":"preview result","back-to-edit":"back to edit","tooltip-mark-background":"Draw lines to mark areas you want to remove from the image","tooltip-mark-object":"Draw lines to mark areas you want to keep in the image"};g.malabiEditorText=y;var e=null,r=null}(this,document);
